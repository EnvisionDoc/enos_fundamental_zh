# 2019/03/05

EnOS Cloud 2019年3月5日发布了以下新服务、特性及更新：

## 新增服务与功能

### 设备管理

#### 固件升级（OTA）

这是OTA服务的首个版本。

作为设备生命周期管理的一部分，EnOS支持空中升级设备固件。使用该功能，你可以在EnOS Cloud上管理设备的固件版本。

- 提供了设备SDK，供设备上报固件信息、请求升级、上报升级结果。要使用包含OTA的最新版本Java SDK，访问 https://github.com/EnvisionIot/enos-mqtt-sdk-java。如果你使用Maven，确保将Maven的依赖升级到2.1.2：
```
<dependency>
    <groupId>com.envisioniot</groupId>
    <artifactId>enos-mqtt</artifactId>
    <version>2.1.2</version>
</dependency>
```

- 支持端到端管理设备固件生命周期。
- 支持配置设备升级策略。EnOS通过MQTT消息通道向符合升级策略的设备推送升级请求，以自动维护升级任务。
- 支持追踪固件升级日志，诊断升级失败原因。

OTA帮助修复固件缺陷、空中升级设备功能，降低维护远端设备成本。该功能在控制台默认开启。选择 ** 设备管理 > OTA**以访问该服务。

.. image:: media/ota.png


#### 批量上报测点信息

从这个版本开始，设备可以批量将新建测点上报至EnOS Cloud。该特性可用于以下场景：

- 网关设备代理其子设备上报测点信息。
- 一个设备一次性批量上报带有不同时间戳的测点信息。
- 以上两种情景的综合。

有关该特性及用例的更多信息，参见[批量上报测点信息](/docs/device-connection/zh_CN/latest/reference/mqtt/upstream/device_else/report_points.html)。

### 数据资产管理

#### TSDB存储策略

这是TSDB存储策略服务的首个版本。

TSDB存储策略服务允许用户配置数据存储策略，例如存储何种数据，在某种存储中将数据存储多长时间。降低数据存储成本，提高数据访问效率。

.. image:: media/storage_policy.png

TSDB存储策略的首个版本提供以下特性：

#### 存储策略分组配置

- 支持创建存储策略分组，针对不同项目不同领域存储需求，分别配置策略。
- 一个标准组织只能拥有2个存储策略分组。

##### 存储策略配置

- 支持为为原始AI数据、规范化AI数据、DI数据和泛型数据
- 对于每一条存储策略，支持选择某个类型测点并配置数据存储时长
- 针对不同的存储，提供了对应的API以帮助用户访问数据

##### 存储策略审计日志

将用户的存储策略操作记录在日志中，方便后续问题分析及定位。

.. note:: 存储策略必须配置。否则，设备数据不会默认被EnOS TSDB存储。

- 每条存储策略都与一个设备模型绑定。存储策略表项是根据其绑定的模型的测点定义的。当模型中定义了新测点时，需要更新该新测点的相应存储策略。
- 当一个测点有相应的存储策略时，该测点的测点类型和数据类型就不能更改了。否则Open API将无法取回已存储的该测点数据。

有关TSDB存储策略的更多信息，参见[TSDB存储策略配置](/docs/data-asset/zh_CN/latest/configuring_tsdb_storage.html)。

#### 数据服务API

EnOS提供了下列新增API，增强数据存储和读取的效率：

`getAssetsStatusData`：对应数字量（DI）数据的TSDB存储策略。该API可获取一段时间内特定资产的状态数据，并只返回反映资产状态变化的数据。例如，一段时间内的原始数据如下所示：

```
Time       Status 
10:01:14    0
10:01:30    0
10:03:45    0
10:12:23    1
10:13:34    0
10:15:24    1
10:17:25    1
```

返回的结果是：

```
Time       Status 
10:01:14    0
10:12:23    1
10:13:34    0
10:15:24    1
```

EnOS服务Java SDK更新了对`getAssetsStatusData`API的支持，可以通过[Maven Repository](https://mvnrepository.com/artifact/com.envisioniot/enos-api)获取该API。

要阅读API文档，登录EnOS控制台，选择 **EnOS API > API文档**。

#### 流数据分析

流数据分析服务新增了流数据预跑功能，以测试数据处理流任务。在数据聚合流任务设计完成后，流数据预跑能够测试并调试数据聚合流任务。当预跑功能运行时，会拦截并处理最新的实时数据，经过处理的数据不会保存在数据库中。用户可以根据预跑结果调试数据处理流。如果预跑结果达到预期，用户就可以开始运行流数据分析。

有关流数据预跑功能的详细信息，参见[维护数据聚合流任务](/docs/data-asset/zh_CN/latest/howto/monitoring_stream.html)。

## 功能改进

### 数据资产管理

#### 数据订阅

本次更新中，数据订阅服务有了如下改进：

##### 错误提示优化

当某个被订阅的数据源被删除，系统会保留数据订阅配置，但是会显示错误信息，报告被配置的数据源为未知对象。

##### 异常检测鉴权优化

对于已存在的数据订阅配置，动态检测SA账号失效及授权关系失效信息。实时更新相关数据订阅配置，延迟不超过5分钟。

- 当SA被删除，其关联的订阅自动失效。
- 当客户解除了对某SA的授权，则对该客户数据的订阅会自动解除。

有关数据订阅的更多信息，参见[数据订阅](/docs/data-asset/zh_CN/latest/learn/data_subscription_overview.html)。
