# 2019/05/09

EnOS Cloud 2019年5月9日发布了以下更新：

## 新增服务与功能

该部分介绍了在本次发布中的新服务及特性。

### 通用服务

为了便于基于业务需求进行计算，存储等资源的管理及扩容，新增资源管理功能。详细信息如下：

#### 资源管理

该功能的首次发布。通过资源管理可以在线进行资源的申请，扩容，管理等操作。首次发布支持以下功能：
- 资源申请：支持在线申请流式计算资源以及时序数据库。根据业务需求，选择相应的规格。不同的规格，对应着不同的处理能力；
- 资源扩容：随着业务增长，现有资源可能无法满足新的需求。可以通过资源扩容，申请更高规格的资源。

该功能当前支持对以下资源的管理：
- 流式计算资源
- 时序数据库

更多信息，参见[资源管理](/docs/enos/zh_CN/latest/resourcemanagement/overview.html)。

#### 数据连接

新增支持注册Blob Storage类型的数据源。更多信息，参见[配置Azure BLOB数据源](/docs/offline-data/zh_CN/latest/data_source/connecting_blob.html)。

### 设备管理

在本次发布中，设备管理产品增加了批量注册设备的功能及有关资产的设备接入服务API。详细信息如下：

#### 批量注册设备

- 为了提升设备接入的效率，支持通过导入`.xlsx`文件批量注册设备。用户可直接下载空白Excel模板，或选择一个已接入的设备导出为模板，在模板中填加所有待注册的设备并导入至EnOS以完成批量注册，当前单次`.xlsx`文件导入最多可添加1000个设备。更多信息，参见[批量导入设备](/docs/device-connection/zh_CN/latest/howto/device/manage/creating_device_in_batch)。

#### 离线消息集成

该功能的首次发布。向第三方系统提供历史数据集成通道，用户可以将存储再第三方系统中的设备的历史数据导入EnOS，并根据事先设置的策略对集成的历史数据进行处理、存储和计算。更多信息，参见[离线消息集成](/docs/device-connection/zh_CN/latest/learn/ingestion/offline_message_integration)。

#### 设备接入API

- `uploadAssetMeasurepoints`：该接口赋予资产树非接入节点（如场站类节点）上报测点数据的能力，常用于流式计算后的数据写入为测点数据的场景；
- `updateAsset`：更新资产信息的接口，支持更新资产的部分属性键值对，而非要求全量更新；
- `getEvent`：按照event ID获取设备上送的事件（event）信息；
- `searchEvent`：按照条件批量获取设备上送的事件（event）信息；

有关API的详细参考信息，登录EnOS控制台并选择**EnOS API > API文档 > Connect Service / Asset Service**。

### 数据资产管理

在数据资产管理产品中，我们新增了电量计算模板，支持了对集成进EnOS的离线数据进行流式计算及存储管理。为了便于用户水平扩展计算及存储能力，新增支持了资源管理。详细信息如下：

#### 流式计算服务

电量计算模板：该计算模板的首次发布。该模板根据电表读数输入来计算天级电量。首次发布包含以下功能：

- 电表读数分段差值累加法：使用电表读数分段差值累加法计算出每个时间段的电量，再将每个时间段的电量进行累计，得到天级电量。计算过程中支持防跳变参数设置、电表读数倍率设置等功能；
- 天级电量：以天作为计算周期，每一天结束之后输出这一天的总电量；
- 明细电量：在计算天级电量过程中，并可同时输出固定时间间隔的电量；

更多信息，参见[电量计算模板](/docs/data-asset/zh_CN/latest/learn/pi_template_overview.html)。

#### 离线数据的计算及管理

该功能的首次发布。支持通过数据资产管理的服务对通过MQTT消息通道上报的设备离线历史数据进行计算与管理，首次发布包含以下功能：

- 支持使用流式计算引擎处理历史数据：针对这个独立的离线数据通道，流式计算可进行独立消费并计算，不影响实时数据的消费及计算。
- 支持通过存储策略配置将离线历史数据存入时序数据库。

更多信息，参见[创建流数据处理任务](/docs/data-asset/zh_CN/latest/howto/stream/creating_job.html)。

#### 资源管理兼容

该功能的首次发布。在进行流式资源扩容后，或在启动新增流数据处理任务时，可选择一个或多个运行中的任务，一键暂停任务，然后再选择需要启动的任务，一键启动多个任务。系统会为启动的任务自动分配计算资源，提高计算资源利用率。

更多信息，参见[维护流数据处理任务](/docs/data-asset/zh_CN/latest/howto/stream/monitoring_job.html)。

<!--

#### 归档存储策略

该功能的首次发布。使用归档存储可对访问频率较低且占用存储空间很大的业务数据进行归档存储。生成的归档文件将根据配置的存储路径信息，自动同步到指定的存储系统中，对数据进行备份。
- 归档指定模型下的设备采集数据及经流数据处理后生成的数据。
- 定义归档文件的属性，包括文件类型、编码格式、列分隔符、压缩格式及文件大小上限等。
- 根据归档文件的数据量和业务对时效性的要求，配置数据归档周期（1小时~24小时）。目前支持将数据归档至Blob Storage。

-->

#### 新增数据服务API

- `getAssetsCurrentDayElectricPower`：获取设备当日累计发电量/用电量；
- `getAssetsElectricPowerData`：获取设备发电量/用电量数据；
- `filterAssetsLatestData`：根据过滤条件过滤测点最新数据。

有关API的详细参考信息，登录EnOS控制台并选择**EnOS API > API文档 > Data Service**。

## 功能改进及行为变更

该部分介绍了在本次发布中的功能改进及行为改变。

### EnOS Edge

新版本预览的首次发布。通过EnOS IoT Hub定义的MQTT与云端进行通讯，同时满足EnOS 2.0全新定义的新版设备模型，设备注册，设备生命期管理等功能。本版本自身的功能基本覆盖前版本。新版本预览版本的新增功能仅支持EnOS2.0。

#### Edge管理

支持查看OU下所有的Edge的当前版本、Device Key等基本信息，添加Edge

#### 数据上传方式

在前版本中，数据的上传方式定义在云端的模型中，对所有的Edge生效，上传方式有变化上送，定时上送，实时上送；在新版本预览版本中，数据从Edge到云端的上送方式直接定义在Edge中的模板中，对同一个模型每一个模板可以使用不同的上送方式。

#### 计算脚本

在前版本版本中，在云端的模型中定义计算模型测点的脚本，对所有的Edge生效；在新版本预览中，在Edge中的模板中定义测点的计算脚本，脚本只对使用该模板接入的设备生效。

#### 规约

- 新版本预览支持的规约列表并没有完全覆盖原来1.0支持的版本，此次发布的版本支持的规约，参见 [已支持的规约列表](/docs/enos-edge/zh_CN/latest/appendix/protocol_list)
- 升级设备规约时，支持选择升级影响的设备范围
- 规约的影响范围不再是模板，而是Edge与设备的连接和Edge本身

#### 设备接入

在新版本预览中，你不再能够在模板中配置规约，而可以配置点表和设备模型。在设备接入中创建新的连接时，需要选择对应的规约类型和规约，一个连接只关联一个规约。

#### 模板

- 在新版本预览的模板中映射测点时，同一个测点可以同时被映射到接入点和控制点上。
- 模板中，mapping，point.cvs等文件的编辑方式有了改进。


