# 2019/06

EnOS Cloud 2019年6月发布了以下更新：

## 新增服务与功能

该部分介绍了在本次发布中的新服务及特性。

### 通用服务

我们增加了通过资源管理功能能够管理的资源种类。同时新增了资源缩容和资源用量告警功能。详细信息如下：

#### 资源管理

通过在线申请可以获得批处理计算队列、数据仓库及文件存储HDFS资源。新增了资源缩容和资源用量告警功能。

- 资源申请：支持在线申请批处理计算队列、数据仓库及文件存储HDFS资源。根据业务需求，选择相应的规格。不同的规格，对应着不同的处理能力；
- 资源缩容：随着业务趋于稳定，已申请资源可能高于业务所需。可以通过资源缩容，降低资源规格，节约成本。
- 资源用量告警：为避免资源不足影响业务正常运行，配置资源用量告警，以实时监测资源使用情况：一旦高于设定的阈值，即发送告警通知，以便及时进行处理，保证业务稳定运行。

该功能当前支持对以下资源的管理：
- 流式计算资源
- 时序数据库
- 批处理计算
- 数据仓库
- 文件存储HDFS

更多信息，参见[资源管理](/docs/enos/zh_CN/latest/resourcemanagement/overview)。

### EnOS Edge

我们发布了EnOS Edge 2.0。除了数据采集网关的功能之外，Edge 2.0提供与云端几乎一致的API Service，流式计算能力，应用支持能力，能够支持云端应用部署运行在Edge平台上，同时支持场站端的原生应用迁移到Edge平台运行。本次发布详细信息如下：

#### 云端服务

- Edge管理：支持搜索Edge，查看Edge当前版本，查看发布状态、通讯状态。

#### Edge平台服务

- 数据转发：支持使用IEC104规约向第三方系统或设备转发数据
- 断点续传：支持在Edge与云端通讯中断后，自动缓存数据并在通讯恢复后继续传输。用户可选择缓存数据续传到云端的方式：优先传输最新数据，或优先传输缓存数据。
- 主备冗余：支持一个Edge对接两个数据源、主备Edge对接一个数据源及主备Edge对接两个数据源。支持应用进行主备判断的API。
- 模型资产服务：提供与云端一致的模型、资产服务。包括模型、产品、资产、资产树关系的同步，以及模型及资产树相关API。
- 数据服务：提供与云端基本一致的API。支持数据查询、以及本地的数据订阅接口
- API服务：提供与云端基本一致的API，支持调用本地应用。

更多信息，参见[EnOS Edge](/docs/enos-edge/zh_CN/latest/edge_overview)。

.. image:: ../media/edge_management.gif

### 设备管理

在本次发布中，设备管理产品支持了非DTLS加密的CoAP协议、添加了设备模拟器等功能。详细信息如下：

#### 非DTLS加密的CoAP协议

新增了对非DTLS加密的CoAP协议的支持。报文采用明文传输，用户可自主决定是否对其加密。更多信息，参见[CoAP连接通信（非DTLS加密）](/docs/device-connection/zh_CN/latest/reference/coap/coap_non_dtls/connection_non_dtls)

#### 设备模拟器

用户可自定义模拟样本，启动模拟器后EnOS根据样本执行数据的模拟上报。更多信息，参见[使用设备模拟器](/docs/device-connection/zh_CN/latest/howto/device/manage/using_device_simulator)。

.. image:: ../media/device_simulator.gif

#### 模型继承路径

新增了模型继承路径信息`modelPath`，记录子模型所继承的父模型层级关系和继承路径，方便应用基于模型的继承关系进行关联查询和数据处理。

#### 缓存命令下发

应用对不在线的NB-IoT设备设置测点或调用服务时，可以选择发送缓存命令，EnOS会在缓存有效期内将该命令保存在缓存队列，待设备上线之后按顺序向其发送命令并执行，用户可以在控制台查看命令的状态。更多信息，参见[管理缓存命令](/docs/device-connection/zh_CN/latest/howto/device/manage/viewing_command_status)。

.. image:: ../media/viewing_command_state.gif

#### 检索及国际化

- 新增根据模型、Device key及Asset ID搜索设备、并按照设备的节点类型和连接状态过滤的功能。
- 新增根据测点名称和标识符搜索设备资产和逻辑资产的测点。
- 新增对设备名称国际化的支持。现在设备名称支持填写中文及英文。

#### Open API优化

提供了v2.0 API；同时对原有API进行了优化，提高了其稳定性和易用性。重点优化了设备、资产树和告警的相关接口。

有关API的详细参考信息，登录EnOS控制台并选择 **EnOS API > API文档 > Connect Service / Asset Service**。

### 数据资产管理

在数据资产管理产品中，我们新增了时序洞察功能、数据归档功能，支持了数据质量报告和数据资产检索。详细信息如下：

#### 时序洞察

提供了时序数据可视化查询工具。查询方式多样化，包括AI或者PI类型的测点聚合查询、DI类型的测点变位查询等；数据展示方式多样化，包括折线图、数据列表等。更多信息，参见[时序洞察概述](/docs/data-asset/zh_CN/latest/howto/storage/data_insights)。

.. image:: ../media/data_insights.gif

#### 数据质量报告

提供了质量报告查询工具，包括完备性、准确性、及时性三个维度的数据质量统计。在单个质量维度下，质量报告提供多种统计方式：包括单设备单点按天统计、多设备同一个测点按天整体统计、单设备单点整体统计等。更多信息，参见[数据质量](/docs/data-asset/zh_CN/latest/learn/data_quality)。

.. image:: ../media/data_quality.gif

#### 数据资产检索

提供了模型测点的元数据检索，包括模型测点的基本信息、流式血缘、存储策略、实例列表等。更多信息，参见[数据资产检索](/docs/data-asset/zh_CN/latest/learn/metadata_explorer)。

.. image:: ../media/data_asset_explorer.gif


<!--#### 原生Streamsets对部分OU开放
开放20个以上的底层算子，支持用户通过拖拽编辑流任务；
-->

#### 数据归档

支持对接实时消息通道，将指定模型下的设备采集数据及流数据处理后生成的数据归档至指定存储系统。更多信息，参见[数据归档概述](/docs/data-asset/zh_CN/latest/howto/archive/archive_policy)。

<!--是否有查阅API的新路径？-->

### 数据分析

在数据分析产品中，我们支持将Azure Blob Storage中的数据同步到EnOS HDFS中。新增了调度系统参数以及数据开发SDK。详细信息如下：

#### 数据集成

支持将Azure Blob Storage中的数据同步到EnOS HDFS中。更多信息，参见[从外部数据库同步文件到文件存储HDFS](/docs/offline-data/zh_CN/latest/data_integration/creating_scratch_blob2hdfs)。

#### 调度系统参数

新增了以下调度系统参数：

- `${hcal_dt8}`: 以当前系统时间为基准，自动向过去偏移1小时，根据偏移后结果，输出当天，格式为 *yyyymmdd*。
- `${cal_ht}`: 以当前系统时间为基准，自动向过去偏移1小时，根据偏移后结果，输出当前小时，格式为 *hh*。

更多信息，参见[系统变量列表](/docs/offline-data/zh_CN/latest/system_variables)。

#### 数据开发SDK

新增SDK - Hive分区删除，支持周期性、自动删除符合格式的Hive数据。可同时删除分区内数据及分区元数据信息，适用于内部表及外部表的情况。更多信息，参见[通用库](/docs/offline-data/zh_CN/latest/common_library)。

### 应用开发

在应用开发产品中，我们增加了应用菜单与权限管理功能、System组织下应用授权功能、EnOS API架构升级及文档变更。APIM增加了对常量参数映射的支持以及OU验证。详细信息如下：

#### 应用菜单与权限管理

支持为EnOS上注册的应用配置菜单、权限，并向客户批量授权应用菜单和权限


#### System组织下的应用授权

支持向组织授权平台应用

更多信息，参见[管理应用](/docs/app-development/zh_CN/latest/managing_apps)。

.. image:: ../media/menu_permission.gif

#### EnOS API文档变更

根据API文档规范重新设计展示EnOS API，支持多语言版本切换，支持历史API版本回看等功能。新版替换旧版EnOS API文档页面，并保留旧版入口。

### APIM

该产品的首次发布。基于APIM（API management，API管理）提供一致的API服务，取消签名机制，使用上更加方便和安全。同时增加了诸如限流、IP访问控制等高级功能插件。详细信息如下：

- 支持用户API挂载托管，对托管API进行组合路由转换，并提供统一的访问方式和鉴权
- API限流功能：可以配置针对单个API的限流，拒绝超过限流的调用请求，保证服务的稳定性；
- API IP访问控制功能：用户可增加 IP访问控制功能，可以通过黑名单和白名单功能， 拒绝/允许超API调用请求，增加API应用的安全性
- 新增了针对新建API、API后端服务、常量参数的映射功能
- 新建API/API基本参数中增加OU验证，用于验证`ORGID`与SA之间的购买关系

更多信息，参见[EnOS API管理](/docs/api-mgmt/zh_CN/latest/)。

.. image:: ../media/apim_demo.gif

### SHC服务托管中心

该产品的首次发布。EnOS服务托管中心（Service Hosting Center，SHC）提供高性能可伸缩的容器应用管理服务，帮助项目负责人创建和管理应用开发项目、配置集群和容器，并帮助应用开发者快速构建和部署应用。SHC容器服务简化了容器管理集群的搭建工作，打造云端最佳容器运行环境。本次发布包括下列功能：

#### 容器服务

- 支持创建部署，为应用和服务创建部署环境和分配部署资源
- 容器自动化部署新增支持Kubernetes StatefulSet资源（有状态副本集）；StatefulSet资源部署支持环境变量配置，从而可实现容器内JVM自适应。
- 创建Service配置，以支撑应用对集群外部暴露Web服务，需要同时配置路由。
- 使用Route把k8s集群中的pod ip和cluter ip暴露集群外部，实现集群外的节点直接访问k8s的pod。
- ConfigMap API资源提供了将配置注入容器的机制，ConfigMap可用于存储细粒度信息如单个属性，或粗粒度信息如整个配置文件或JSON对象。ConfigMap API资源存储键值对配置数据，这些数据可以在pods里使用。ConfigMap跟Secret类似，但是ConfigMap可以更方便的处理不包含敏感信息的字符串。
- Secret解决了密码、token、密钥等敏感数据的配置问题，而不需要把这些敏感数据暴露到镜像或者Pod Spec中。Secret可以以Volume或者环境变量的方式使用。

#### 工具集集成

- Redmine
- Jenkins
- Gitlab
- SonarQube
- Nexus
- NPM
- Harbor

#### DB容器应用集成

- Redix
- MySql
- Mongo

#### 日志服务

包括了日志服务、告警服务等

更多信息，参见[有关EnOS服务托管中心](/docs/apaas/zh_CN/latest/about/apaas_overview)。

## 功能改进及行为变更

该部分介绍了在本次发布中的功能改进及行为改变。

### 设备管理

#### 资产树功能优化

- 优化了资产树页面交互；
- 支持批量关联设备到资产树的指定节点；
- 将资产分为设备资产和逻辑资产
- 支持查看继承自父模型的功能点的功能详情

#### 告警历史数据

- 优化了告警历史数据的展示。

### 数据资产管理

- “AI窗口聚合模板”更名为“时间窗口聚合模板”，支持所有数值类型数据的聚合处理
- 调整了流式计算各算法模板以兼容测点的`modelPath`属性，保证父模型中测点所在的计算策略能同时作用于父模型实例和所有子模型实例

#### 数据相关API优化

- 支持资产测点数据按local time进行查询；
- 增加了资产鉴权功能，只有SA被授权的资产才能获取到数据；
- 所有有`modelId`参数的数据open API都变更为`modelId`非必选参数，即支持不同modelId的多个资产进行数据查询；

有关API的详细参考信息，登录EnOS控制台并选择 **EnOS API > API文档 > Data Service** 。

### EnOS Edge

#### 模板管理

- 支持在线编辑点表文件
- 移除了规约与模板的绑定关系
- 支持下载点表文件模板
- 支持模板的导入导出

#### 规约管理

- 支持选择规约升级的影响范围

#### 模板映射

- 支持添加数据处理脚本
- 支持在模板中定义模型点数据上传方式
- 支持统一的测点同时接入和控制映射

#### 通讯规约

通过重新开发的DPF（Device Protocol Framework）模块，实现同一种规约在各种Edge产品系列中的跨平台运行，同时Edge 2.0已完成大部分原有规约迁移到新DPF框架的工作，当前规约已实现了覆盖电力能源，楼宇，工业园区等行业90%以上的规约。

## Bug修复

该部分介绍了在本次发布中修复的bug。

### 设备管理

- 告警模块的作用域功能问题已修复。

## 已弃用功能

该部分介绍了在本次发布中弃用或者移除的服务及特性。

### 设备管理

- 资产树删除了NodeId信息；
- 不再支持创建空节点；
- 一个设备在单棵资产树下不再能关联多个节点，只能关联一个节点；
- 设备详情页面不再展示设备历史数据，查看历史数据时会跳转到时序洞察页面

### 数据资产管理

- 取消了只有任务创建者才能编辑的设计，支持当前OU下所有有权限的用户编辑流式计算任务

### EnOS Edge

- 模板管理取消了模板与规约的关联。

